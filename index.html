<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>📖 Heldentagebuch Südaventurien</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="dark">

  <button id="toggleDarkMode" title="Modus wechseln">☀️</button>

  <div class="sidebar">
    <h2>🧭 Navigation</h2>
    <ul>
      <li><a href="#willkommen">🏰 Willkommen</a></li>
      <li><a href="#helden">🛡️ Helden</a></li>
      <li><a href="#chronik">📜 Chronik</a></li>
      
    </ul>
  </div>

  <div class="content">
    <section id="willkommen">
      <h1>Willkommen im Heldentagebuch</h1>
      <p>Die Wellen des Südmeers tragen Geschichten von Mut, List und Magie.</p>
    </section>

    <section id="helden">
      <h2>🛡️ Helden</h2>
      <p>Bald wirst du hier deine Gefährten sehen...</p>
    </section>

    <section id="chronik">
      <h2>📜 Chronik</h2>
      <div id="eintraegeContainer"></div>
    </section>

    


      
      
    </section>
  </div>

  <script src="script.js"></script>

<script src="https://apis.google.com/js/api.js"></script>
<script>
const CLIENT_ID = "430148415475-ie691161c18i8g2vqpb06g50fdg4uu1c.apps.googleusercontent.com";
const SCOPES = "https://www.googleapis.com/auth/drive";
const FOLDER_ID = "1PnAzqviveTXXaLuJ-srfcwhS9NN30xEb";
let accessToken = "";

function handleClientLoad() {
  gapi.load("client:auth2", initClient);
}

function initClient() {
  gapi.client.init({
    clientId: CLIENT_ID,
    scope: SCOPES
  }).then(() => {
    accessToken = gapi.auth.getToken().access_token;
    listChronik();
  });
}

function handleAuthClick() {
  gapi.auth2.getAuthInstance().signIn().then(() => {
    accessToken = gapi.auth.getToken().access_token;
    listChronik();
  });
}

function uploadFiles() {
  const files = document.getElementById("fileInput").files;
  if (!files.length) {
    alert("Bitte mindestens eine Datei auswählen.");
    return;
  }
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const metadata = {
      name: file.name,
      mimeType: file.type,
      parents: [FOLDER_ID]
    };
    const form = new FormData();
    form.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
    form.append("file", file);

    fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id", {
      method: "POST",
      headers: new Headers({ Authorization: "Bearer " + accessToken }),
      body: form
    })
    .then(res => res.json())
    .then(val => {
      document.getElementById("upload-output").innerText += '✅ ' + file.name + ' hochgeladen\n';
      listChronik();
    })
    .catch(err => {
      console.error(err);
      document.getElementById("upload-output").innerText = "❌ Fehler beim Hochladen.";
    });
  }
}

function listChronik() {
  fetch(`https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+mimeType='text/markdown'&fields=files(id,name)&orderBy=name`, {
    headers: { Authorization: "Bearer " + accessToken }
  })
  .then(res => res.json())
  .then(data => {
    const list = document.getElementById("chronikList");
    list.innerHTML = "";
    data.files.forEach(file => {
      const link = document.createElement("a");
      link.textContent = file.name;
      link.style.cursor = "pointer";
      link.onclick = () => previewFile(file.id);
      list.appendChild(link);
    });
  });
}

function previewFile(fileId) {
  fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, {
    headers: { Authorization: "Bearer " + accessToken }
  })
  .then(res => res.text())
  .then(md => {
    const html = md
      .replace(/^### (.*$)/gim, "<h3>$1</h3>")
      .replace(/^## (.*$)/gim, "<h2>$1</h2>")
      .replace(/^# (.*$)/gim, "<h1>$1</h1>")
      .replace(/\*\*(.*?)\*\*/gim, "<b>$1</b>")
      .replace(/\*(.*?)\*/gim, "<i>$1</i>")
      .replace(/\n/g, "<br>");
    document.getElementById("previewContent").innerHTML = html;
  });
}

handleClientLoad();
</script>

</body>
</html>
